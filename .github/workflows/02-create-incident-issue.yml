      - name: Create incident issue from sample alert JSON
        env:
          GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
        run: |
          set -e

          # Ensure labels exist (ignore errors if they already exist)
          gh label create incident --description "Security incident created from detection" || true
          gh label create siem --description "SIEM alert / detection related" || true

          python <<'PY'
          import json
          import subprocess

          with open("docs/sample-alert-password-spray.json") as f:
              a = json.load(f)

          title = a["alert_name"]

          body = f"""## Incident: {a['alert_name']}

          **Severity:** {a['severity']}
          **Time window:** {a['time_window']}
          **Trigger reason:** {a['trigger_reason']}

          ### Key details
          - **Source IP:** {a['source_ip']}
          - **Targeted users:** {', '.join(a['targeted_users'])}
          - **First seen:** {a['first_seen']}
          - **Last seen:** {a['last_seen']}

          ### Notes
          {a['notes']}

          ### Next actions (analyst)
          - Validate if source IP is expected (VPN / known ranges)
          - Check if any targeted user had a successful login after failures
          - Consider temporary IP block / conditional access challenge
          - Document outcome and close this issue
          """

          subprocess.run(
              ["gh", "issue", "create",
               "--title", title,
               "--body", body,
               "--label", "incident,siem"],
              check=True
          )
          PY
